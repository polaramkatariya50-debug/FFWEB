
<!DOCTYPE html>
<html lang="en">

<head>
    <base href="./">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friends - Free Fire Bot</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #00ff88;
            --secondary-color: #ff8800;
            --success-color: #00ff88;
            --warning-color: #ff8800;
            --danger-color: #ff4444;
            --dark-bg: #000000;
            --card-bg: rgba(20, 20, 20, 0.95);
            --text-dark: #ffffff;
            --text-light: #888888;
            --border-radius: 12px;
            --shadow: 0 8px 32px rgba(0, 255, 136, 0.1), 0 4px 16px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 12px 48px rgba(0, 255, 136, 0.2);
            --gradient-primary: linear-gradient(135deg, #00ff88 0%, #00cc6e 100%);
            --gradient-success: linear-gradient(135deg, #00ff88 0%, #00cc6e 100%);
            --gradient-danger: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            --gradient-warning: linear-gradient(135deg, #ff8800 0%, #cc6600 100%);
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000000;
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(0, 255, 136, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 136, 0, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(0, 255, 136, 0.02) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* Result Message Styles */
        .result-message {
            padding: 12px 15px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
            animation: fadeIn 0.3s ease;
        }

        .result-success {
            background: rgba(0, 255, 136, 0.1);
            color: var(--success-color);
            border: 2px solid rgba(0, 255, 136, 0.3);
        }

        .result-error {
            background: rgba(255, 68, 68, 0.1);
            color: var(--danger-color);
            border: 2px solid rgba(255, 68, 68, 0.3);
        }
        
        .result-warning {
            background: rgba(255, 136, 0, 0.1);
            color: var(--warning-color);
            border: 2px solid rgba(255, 136, 0, 0.3);
        }

        .result-info {
            background: rgba(0, 150, 255, 0.1);
            color: #0066cc;
            border: 2px solid rgba(0, 150, 255, 0.3);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
}

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
            position: relative;
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            margin-bottom: 15px;
            font-weight: 800;
            color: var(--primary-color);
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            letter-spacing: 1px;
            position: relative;
        }

        .header h1::before {
            content: 'ðŸ‘¥';
            display: inline-block;
            margin-right: 15px;
        }

        .header p {
            font-size: 1.2rem;
            color: var(--text-light);
            font-weight: 400;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 14px 28px;
            background: var(--card-bg);
            color: white;
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            border: 2px solid rgba(0, 255, 136, 0.2);
            font-weight: 600;
            box-shadow: var(--shadow);
        }

        .nav-btn:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: var(--gradient-primary);
            color: black;
            border-color: var(--primary-color);
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: var(--card-bg);
            border: 2px solid rgba(0, 255, 136, 0.2);
            border-radius: 8px;
            padding: 10px;
            color: var(--primary-color);
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        .mobile-menu-toggle:hover {
            border-color: var(--primary-color);
        }

        /* Mobile Overlay */
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mobile-overlay.show {
            display: block;
            opacity: 1;
        }

        /* Mobile Side Panel */
        .mobile-side-panel {
            position: fixed;
            top: 0;
            left: -300px;
            width: 280px;
            height: 100%;
            background: var(--card-bg);
            border-right: 2px solid rgba(0, 255, 136, 0.2);
            z-index: 1000;
            transition: left 0.3s ease;
            padding: 20px;
            box-shadow: var(--shadow-lg);
            overflow-y: auto;
        }

        .mobile-side-panel.show {
            left: 0;
        }

        .mobile-side-panel h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 700;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(0, 255, 136, 0.2);
        }

        .mobile-nav-btn {
            display: block;
            width: 100%;
            padding: 15px 20px;
            margin-bottom: 10px;
            background: var(--card-bg);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            border: 2px solid rgba(0, 255, 136, 0.2);
            transition: all 0.3s ease;
            text-align: center;
        }

        .mobile-nav-btn:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--primary-color);
        }

        .mobile-nav-btn.active {
            background: var(--gradient-primary);
            color: black;
            border-color: var(--primary-color);
        }

        .mobile-nav-btn.logout {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            border-color: #dc2626;
        }

        /* Friends Content */
        .friends-content {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .friends-sidebar {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(0, 255, 136, 0.15);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .sidebar-nav-item {
            display: block;
            padding: 12px 15px;
            color: var(--text-dark);
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            margin-bottom: 8px;
            border-radius: 6px;
        }

        .sidebar-nav-item:hover {
            background: rgba(0, 255, 136, 0.1);
            border-left-color: var(--primary-color);
        }

        .sidebar-nav-item.active {
            background: var(--gradient-primary);
            color: var(--dark-bg);
            border-left-color: var(--dark-bg);
            font-weight: 700;
        }

        .friends-main {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(0, 255, 136, 0.15);
        }

        .friends-header {
            margin-bottom: 30px;
        }

        .friends-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 255, 136, 0.2);
            border-radius: 8px;
            color: var(--text-dark);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            font-size: 18px;
        }

        .friends-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }

        .friend-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .friend-item:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--primary-color);
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }

        .friend-item.selected {
            background: rgba(0, 255, 136, 0.15);
            border-color: var(--primary-color);
            border-width: 2px;
        }

        .friend-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary-color);
            margin-right: 10px;
            flex-shrink: 0;
        }

        .bulk-action-bar {
            display: none;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .bulk-action-bar.show {
            display: flex;
        }

        .bulk-action-info {
            flex: 1;
            color: var(--text-dark);
            font-weight: 600;
        }

        .bulk-action-buttons {
            display: flex;
            gap: 10px;
        }

        .bulk-action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .bulk-action-btn.select-all {
            background: rgba(0, 255, 136, 0.2);
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .bulk-action-btn.select-all:hover {
            background: rgba(0, 255, 136, 0.3);
        }

        .bulk-action-btn.remove-selected {
            background: var(--gradient-danger);
            color: white;
        }

        .bulk-action-btn.remove-selected:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 68, 68, 0.4);
        }

        .bulk-action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .friend-avatar {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            border: 2px solid var(--primary-color);
            background: var(--dark-bg);
            object-fit: cover;
            flex-shrink: 0;
        }

        .friend-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .friend-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .friend-status {
            font-size: 12px;
            color: var(--text-light);
        }

        .friend-status.online {
            color: var(--primary-color);
            font-weight: 600;
        }

        .friend-status.in-team {
            color: var(--warning-color);
            font-weight: 600;
        }

        .friend-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .friend-action-btn {
            width: 35px;
            height: 35px;
            border: 2px solid rgba(0, 255, 136, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: var(--text-light);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .friend-action-btn:hover {
            background: rgba(0, 255, 136, 0.2);
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .friend-action-btn.accept {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .friend-action-btn.accept:hover {
            background: rgba(0, 255, 136, 0.3);
        }

        .friend-action-btn.decline {
            background: rgba(255, 68, 68, 0.1);
            border-color: var(--danger-color);
            color: var(--danger-color);
        }

        .friend-action-btn.decline:hover {
            background: rgba(255, 68, 68, 0.3);
        }

        .friends-footer {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid rgba(0, 255, 136, 0.2);
            text-align: center;
        }

        .invite-text {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 15px;
        }

        .social-icons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .social-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 255, 136, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .social-icon:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.2);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }

        .loading i {
            font-size: 32px;
            color: var(--primary-color);
            animation: spin 1s linear infinite;
            margin-bottom: 10px;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .error-message {
            text-align: center;
            padding: 40px;
            color: var(--danger-color);
            background: rgba(255, 68, 68, 0.1);
            border-radius: 8px;
            border: 2px solid var(--danger-color);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 64px;
            color: var(--text-light);
            opacity: 0.3;
            margin-bottom: 20px;
        }

        /* Member Info Modal */
        .member-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            pointer-events: none;
        }

        .member-modal.show {
            display: block;
            pointer-events: all;
        }

        .member-modal-content {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            max-width: 400px;
            width: auto;
            max-height: 70vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            border: 2px solid rgba(0, 255, 136, 0.3);
            position: absolute;
            pointer-events: all;
        }

        .member-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0, 255, 136, 0.2);
        }

        .member-modal-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            font-weight: 700;
        }

        .member-modal-close {
            background: var(--gradient-danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .member-modal-close:hover {
            transform: rotate(90deg);
        }

        .member-info-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .member-info-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 136, 0.1);
        }

        .member-info-label {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-bottom: 3px;
            text-transform: uppercase;
        }

        .member-info-value {
            font-size: 0.9rem;
            color: var(--text-dark);
            font-weight: 600;
        }

        .member-clothes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .member-clothes-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            border: 2px solid rgba(0, 255, 136, 0.2);
            transition: all 0.3s ease;
        }

        .member-clothes-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .member-clothes-image {
            width: 60px;
            height: 60px;
            border-radius: 6px;
            margin-bottom: 5px;
            object-fit: contain;
        }

        .member-clothes-id {
            font-size: 0.7rem;
            color: var(--text-light);
        }

        .player-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0, 255, 136, 0.2);
        }

        .player-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid var(--primary-color);
            margin-bottom: 10px;
            object-fit: cover;
        }

        .player-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .player-level {
            font-size: 0.9rem;
            color: var(--primary-color);
        }

        .section-title {
            font-size: 1rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-section {
            margin-bottom: 20px;
        }

        .info-card {
            width: 100%;
        }

        .add-search-section {
            margin-bottom: 20px;
        }

        .add-search-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 255, 136, 0.2);
            border-radius: 8px;
            color: var(--text-dark);
            font-size: 14px;
            margin-bottom: 15px;
        }

        .add-search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }

        .add-search-btn {
            width: 100%;
            padding: 12px;
            background: var(--gradient-primary);
            color: var(--dark-bg);
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-search-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .add-search-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }

            .nav-buttons {
                display: none;
            }

            .friends-content {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .friends-sidebar {
                position: relative;
                top: 0;
                padding: 15px;
            }

            .container {
                padding: 15px 10px;
                padding-top: 70px;
                max-width: 100%;
                overflow-x: hidden;
            }

            .header {
                margin-bottom: 20px;
                text-align: center;
            }

            .header h1 {
                font-size: clamp(1.8rem, 6vw, 2.5rem);
                margin-bottom: 20px;
                line-height: 1.2;
            }

            .header p {
                font-size: 1rem;
                margin-bottom: 0;
                opacity: 0.9;
            }

            .friends-main {
                padding: 20px 15px;
            }

            .friends-title {
                font-size: 1.2rem;
                margin-bottom: 15px;
            }

            .search-input {
                font-size: 16px;
                /* Prevents zoom on iOS */
                padding: 12px 40px 12px 15px;
            }

            .friend-item {
                padding: 12px;
                gap: 12px;
            }

            .friend-avatar {
                width: 50px;
                height: 50px;
            }

            .friend-name {
                font-size: 14px;
            }

            .friend-status {
                font-size: 11px;
            }

            .friend-action-btn {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }

            .bulk-action-bar {
                flex-direction: column;
                gap: 10px;
                padding: 12px 15px;
            }

            .bulk-action-buttons {
                flex-wrap: wrap;
                gap: 8px;
            }

            .bulk-action-btn {
                padding: 8px 12px;
                font-size: 0.85rem;
            }

            .member-modal-content {
                max-width: 95%;
                width: 95%;
                max-height: 85vh;
                padding: 15px;
            }

            .member-info-grid {
                grid-template-columns: 1fr;
            }

            .member-clothes-grid {
                grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
                gap: 8px;
            }

            .member-clothes-image {
                width: 50px;
                height: 50px;
            }

            .player-avatar {
                width: 80px;
                height: 80px;
            }

            .player-name {
                font-size: 1.1rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px 5px;
                padding-top: 60px;
            }

            .header h1 {
                font-size: clamp(1.2rem, 6vw, 1.6rem);
            }

            .friends-main {
                padding: 15px 10px;
            }

            .friends-sidebar {
                padding: 12px;
            }

            .friend-item {
                padding: 10px;
                gap: 10px;
            }

            .friend-avatar {
                width: 45px;
                height: 45px;
            }

            .friend-name {
                font-size: 13px;
            }

            .friend-action-btn {
                width: 30px;
                height: 30px;
                font-size: 12px;
            }

            .member-modal-content {
                max-width: 98%;
                width: 98%;
                padding: 12px;
            }

            .player-avatar {
                width: 70px;
                height: 70px;
            }
        }

        /* Account Selection Modal */
        .account-selection-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .account-selection-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .account-selection-content {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            border: 2px solid rgba(0, 255, 136, 0.3);
        }

        .account-selection-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .account-selection-header h2 {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .account-selection-header p {
            color: var(--text-light);
            font-size: 1rem;
        }

        .account-list {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .account-item {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(0, 255, 136, 0.2);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .account-item:hover {
            border-color: var(--primary-color);
            transform: translateX(5px);
            background: rgba(0, 255, 136, 0.1);
        }

        .account-item.selected {
            border-color: var(--primary-color);
            background: rgba(0, 255, 136, 0.15);
        }

        .account-item-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .account-item-uid {
            font-size: 0.9rem;
            color: var(--text-light);
            font-family: 'Courier New', monospace;
        }

        .account-selection-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .account-selection-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .account-selection-btn-primary {
            background: var(--gradient-primary);
            color: black;
        }

        .account-selection-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.4);
        }

        .account-selection-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .no-accounts-message {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }

        .no-accounts-message a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
        }

        .no-accounts-message a:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <!-- Mobile Menu Toggle -->
    <div class="mobile-menu-toggle" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
    </div>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>

    <!-- Mobile Side Panel -->
    <div class="mobile-side-panel" id="mobileSidePanel">
        <div style="margin-bottom: 30px;">
            <h3>Menu</h3>
            <a href="web.html" class="mobile-nav-btn">
                <i class="fas fa-gamepad"></i> Bot Control
            </a>
            <a href="accounts.html" class="mobile-nav-btn">
                <i class="fas fa-user"></i> Account Management
            </a>
            <a href="owner-info.html" class="mobile-nav-btn">
                <i class="fas fa-info-circle"></i> Owner Information
            </a>
            <a href="clan-search.html" class="mobile-nav-btn">
                <i class="fas fa-search"></i> Clan Search
            </a>
            <a href="bot-info.html" class="mobile-nav-btn">
                <i class="fas fa-robot"></i> Bot Info
            </a>
            <a href="friends.html" class="mobile-nav-btn">
                <i class="fas fa-user-friends"></i> Friends
            </a>
            
            <a href="change-credentials.html" class="mobile-nav-btn">
                <i class="fas fa-key"></i> Change Credentials
            </a>
            <a href="logout.html" class="mobile-nav-btn logout">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
            
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>Friends</h1>
            <p>View and manage your Free Fire friends list</p>
        </div>

        <div class="nav-buttons">
            <a href="web.html" class="nav-btn">
                <i class="fas fa-gamepad"></i> Bot Control
            </a>
            <a href="accounts.html" class="nav-btn">
                <i class="fas fa-user"></i> Account Management
            </a>
            <a href="owner-info.html" class="nav-btn">
                <i class="fas fa-info-circle"></i> Owner Information
            </a>
            <a href="clan-search.html" class="nav-btn">
                <i class="fas fa-search"></i> Clan Search
            </a>
            <a href="bot-info.html" class="nav-btn">
                <i class="fas fa-robot"></i> Bot Info
            </a>
            <a href="friends.html" class="nav-btn">
                <i class="fas fa-user-friends"></i> Friends
            </a>
            
            <a href="change-credentials.html" class="nav-btn">
                <i class="fas fa-key"></i> Change Credentials
            </a>
            <a href="logout.html" class="nav-btn"
                style="background: linear-gradient(135deg, #dc2626, #b91c1c);">
                <i class="fas fa-sign-out-alt"></i> Logout
            </a>
            
        </div>

        <div class="friends-content">
            <!-- Sidebar -->
            <div class="friends-sidebar">
                <a href="#" class="sidebar-nav-item active" data-category="game-friends">
                    <i class="fas fa-users"></i> GAME FRIENDS
                </a>
                <a href="#" class="sidebar-nav-item" data-category="dynamic-duo">
                    <i class="fas fa-user-friends"></i> DYNAMIC DUO
                </a>
                <a href="#" class="sidebar-nav-item" data-category="platoon">
                    <i class="fas fa-users-cog"></i> THE PLATOON
                </a>
                <a href="#" class="sidebar-nav-item" data-category="platform-friends">
                    <i class="fas fa-link"></i> PLATFORM FRIENDS
                </a>
                <a href="#" class="sidebar-nav-item" data-category="add">
                    <i class="fas fa-user-plus"></i> ADD
                </a>
                <a href="#" class="sidebar-nav-item" data-category="blacklist">
                    <i class="fas fa-ban"></i> BLACKLIST
                </a>
                <a href="#" class="sidebar-nav-item" data-category="applications">
                    <i class="fas fa-inbox"></i> APPLICATIONS
                </a>
            </div>

            <!-- Main Content -->
            <div class="friends-main">
                <div class="friends-header">
                    <div class="friends-title" id="friendsTitle">GAME FRIENDS <span id="friendsCount">0/0</span> (MAX.
                        LIMIT +100)</div>
                    <div class="search-container" id="searchContainer" style="display: block;">
                        <input type="text" class="search-input" id="searchInput" placeholder="Search for a friend">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    <div class="add-search-section" id="addSearchSection" style="display: none;">
                        <input type="text" class="add-search-input" id="addSearchInput"
                               placeholder="Enter Friend UID (e.g., 4319191744)"
                               onkeypress="if(event.key === 'Enter') searchAndDisplayFriend()">
    
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0;">
                            <button class="btn" onclick="searchAndDisplayFriend()" 
                                    style="background: var(--gradient-primary);">
                                <i class="fas fa-search"></i> Get Info
                            </button>
                            <button class="btn" onclick="clearFriendSearch()"
                                    style="background: var(--gradient-warning);">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
    
                        <!-- Friend Display Card -->
                        <div id="friendDisplayCard" style="display: none; margin-top: 20px;">
                            <div style="background: rgba(0, 0, 0, 0.3); border-radius: 12px; padding: 20px; 
                                        border: 2px solid rgba(0, 255, 136, 0.2);">
                                <div style="display: flex; gap: 20px; align-items: center;">
                                    <!-- Avatar on left -->
                                    <div style="flex-shrink: 0; position: relative;">
                                        <img id="friendAvatarDisplay" src="" alt="Friend Avatar" 
                                             style="width: 100px; height: 100px; border-radius: 50%; 
                                                    border: 3px solid var(--primary-color);">
                                        <div id="avatarLoading" style="display: none; position: absolute; top: 0; left: 0; 
                                             width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); border-radius: 50%; 
                                             display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-spinner fa-spin" style="color: var(--primary-color); font-size: 20px;"></i>
                                        </div>
                                    </div>
                
                                    <!-- Info and Add Button on right -->
                                    <div style="flex: 1;">
                                        <h3 id="friendUidDisplay" style="color: var(--primary-color); margin-bottom: 5px; 
                                            font-size: 1.1rem;">UID: </h3>
                                        <p style="color: var(--text-light); margin-bottom: 15px; font-size: 0.9rem;">
                                            Click Add Friend to send request
                                        </p>
                    
                                        <div style="display: flex; gap: 10px;">
                                            <button id="addFriendBtn" class="btn" onclick="sendFriendRequest()" 
                                                    style="flex: 1; background: var(--gradient-success);">
                                                <i class="fas fa-user-plus"></i> Add Friend
                                            </button>
                                            <button class="btn" onclick="viewFriendProfile()"
                                                    style="flex: 1; background: var(--gradient-primary);">
                                                <i class="fas fa-eye"></i> View Profile
                                            </button>
                                        </div>
                                    </div>
                                </div>
            
                                <!-- Result Message -->
                                <div id="friendResult" class="result-message" style="display: none; margin-top: 15px;"></div>
                            </div>
                        </div>
    
                        <!-- Current Account Info -->
                        <div id="currentAccountInfo" style="margin-top: 20px; padding: 15px; background: rgba(0, 0, 0, 0.2); 
                             border-radius: 8px; border: 1px solid rgba(0, 255, 136, 0.1);">
                            <div style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 5px;">
                                <i class="fas fa-key"></i> Using account from black_apis.txt:
                            </div>
                            <div id="accountDetails" style="color: var(--primary-color); font-weight: 600;">
                                Loading account...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bulk Action Bar -->
                <div class="bulk-action-bar" id="bulkActionBar">
                    <div class="bulk-action-info" id="bulkActionInfo">
                        <span id="selectedCount">0</span> selected
                    </div>
                    <div class="bulk-action-buttons">
                        <button class="bulk-action-btn select-all" onclick="selectAllFriends()">
                            <i class="fas fa-check-square"></i> Select All
                        </button>
                        <button class="bulk-action-btn select-all" onclick="deselectAllFriends()">
                            <i class="fas fa-square"></i> Deselect All
                        </button>
                        <button class="bulk-action-btn remove-selected" onclick="bulkRemoveFriends()">
                            <i class="fas fa-trash"></i> Remove Selected
                        </button>
                    </div>
                </div>

                <div class="friends-list" id="friendsList">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <div>Loading friends...</div>
                    </div>
                </div>

                <div class="friends-footer">
                    <div class="invite-text">Invite friends</div>
                    <div class="social-icons">
                        <div class="social-icon" title="Copy Link">
                            <i class="fas fa-link"></i>
                        </div>
                        <div class="social-icon" title="LINE">
                            <i class="fab fa-line"></i>
                        </div>
                        <div class="social-icon" title="WhatsApp">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <div class="social-icon" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </div>
                        <div class="social-icon" title="Share">
                            <i class="fas fa-share-alt"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    

    <script>
        // Get application root for URL prefixing
        const applicationRoot = '/vqgay4p4g9';

        // Helper function to prefix URLs with application root
        function url(path) {
            if (!path) return applicationRoot || '/';
            if (path.startsWith('http://') || path.startsWith('https://') || path.startsWith('//')) {
                return path; // External URLs, don't modify
            }
            const cleanPath = path.startsWith('/') ? path : '/' + path;
            return applicationRoot ? (applicationRoot + cleanPath) : cleanPath;
        }


        let friendsData = [];
        let filteredFriends = [];
        let searchResults = [];
        let selectedFriends = new Set(); // Track selected friend UIDs

        // Mobile menu functions
        function toggleMobileMenu() {
            const panel = document.getElementById('mobileSidePanel');
            const overlay = document.getElementById('mobileOverlay');
            panel.classList.toggle('show');
            overlay.classList.toggle('show');
        }

        function closeMobileMenu() {
            const panel = document.getElementById('mobileSidePanel');
            const overlay = document.getElementById('mobileOverlay');
            panel.classList.remove('show');
            overlay.classList.remove('show');
        }

        // Load friends list
        async function loadFriends() {
            const friendsList = document.getElementById('friendsList');

            // Ensure friendsList is visible and in correct display mode
            friendsList.style.display = 'flex';
            friendsList.style.flexDirection = 'column';

            // Show loading state
            friendsList.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i><div>Loading friends...</div></div>';

            try {
                const apiUrl = url('/api/friends');
                const response = await fetch(apiUrl, {
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                // Check if response is JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    console.error('Non-JSON response:', text.substring(0, 200));
                    showNotification('Error: Server returned invalid response. Status: ' + response.status, 'error');
                    friendsList.innerHTML = '<div class="empty-state"><h3>Error</h3><p>Failed to load friends. Check console for details.</p></div>';
                    return;
                }

                const data = await response.json();

                if (data.success && data.data) {
                    friendsData = data.data.friends || [];
                    filteredFriends = [...friendsData];

                    updateFriendsCount();
                    // Update title with correct count after count is updated
                    const friendsTitleEl = document.getElementById('friendsTitle');
                    const friendsCountEl = document.getElementById('friendsCount');
                    if (friendsTitleEl) {
                        if (friendsCountEl) {
                            const countText = friendsCountEl.textContent;
                            friendsTitleEl.innerHTML = 'GAME FRIENDS <span id="friendsCount">' + countText + '</span> (MAX. LIMIT +100)';
                        } else {
                            const countText = `${filteredFriends.length}/${friendsData.length}`;
                            friendsTitleEl.textContent = 'GAME FRIENDS ' + countText + ' (MAX. LIMIT +100)';
                        }
                    }
                    renderFriends();
                } else {
                    friendsList.innerHTML = `<div class="error-message">${escapeHtml(data.message || 'Error loading friends')}</div>`;
                }
            } catch (error) {
                friendsList.innerHTML = `<div class="error-message">Network error: ${escapeHtml(error.message)}</div>`;
            }
        }

        // Update friends count
        function updateFriendsCount() {
            const totalFriends = friendsData.length;
            const displayedFriends = filteredFriends.length;
            const friendsCountEl = document.getElementById('friendsCount');
            if (friendsCountEl) {
                friendsCountEl.textContent = `${displayedFriends}/${totalFriends}`;
            }
        }

        // Render friends list
        async function renderFriends() {
            const friendsList = document.getElementById('friendsList');

            if (filteredFriends.length === 0) {
                friendsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-friends"></i>
                        <div>No friends found</div>
                    </div>
                `;
                return;
            }

            const uids = filteredFriends.map(f => f.uid);
            let friendsWithAvatars = filteredFriends.map(f => ({ ...f, headPic: 902000092 }));

            friendsList.innerHTML = friendsWithAvatars.map(friend => {
                const avatarUrl = `https://ffitem.falconx64.store/?get=${friend.headPic || 902000092}.png`;
                const isSelected = selectedFriends.has(String(friend.uid));
                const safeUid = String(friend.uid).replace(/'/g, "\\'").replace(/"/g, '&quot;');
                const safeName = escapeHtml(friend.name || 'Unknown').replace(/'/g, "\\'").replace(/"/g, '&quot;');

                return `
                    <div class="friend-item ${isSelected ? 'selected' : ''}" data-uid="${friend.uid}" data-name="${escapeHtml(friend.name || 'Unknown')}" data-headpic="${friend.headPic || 902000092}">
                        <input type="checkbox" class="friend-checkbox" ${isSelected ? 'checked' : ''} onchange="toggleFriendSelection('${safeUid}', this.checked)" onclick="event.stopPropagation()">
                        <img src="${avatarUrl}" alt="${escapeHtml(friend.name || 'Unknown')}" class="friend-avatar" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Crect fill=\'%23000\' width=\'60\' height=\'60\'/%3E%3C/svg%3E'">
                        <div class="friend-info">
                            <div class="friend-name">${escapeHtml(friend.name || 'Unknown')}</div>
                            <div class="friend-details">
                                <span class="friend-status">Offline</span>
                            </div>
                        </div>
                        <div class="friend-actions">
                            <button class="friend-action-btn" onclick="event.stopPropagation(); sendGift('${friend.uid}')" title="Send Gift">
                                <i class="fas fa-gift"></i>
                            </button>
                            <button class="friend-action-btn" onclick="event.stopPropagation(); openChat('${friend.uid}')" title="Chat">
                                <i class="fas fa-comment"></i>
                            </button>
                            <button class="friend-action-btn decline" onclick="event.stopPropagation(); removeFriend('${friend.uid}', '${safeName}')" title="Remove Friend">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // Update bulk action bar visibility
            updateBulkActionBar();

            // Progressive fetching - fetch one by one and update as each completes
            if (uids.length > 0) {
                async function fetchAndUpdateProgressive() {
                    for (let i = 0; i < uids.length; i++) {
                        const uid = uids[i];
                        try {
                            const response = await fetch(url('/api/player-info'), {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                credentials: 'include',
                                body: JSON.stringify({ uid: uid })
                            });

                            if (response.ok) {
                                const data = await response.json();
                                if (data.status === 'success' && data.data) {
                                    const playerData = data.data || {};
                                    const basicInfo = playerData.basicinfo || playerData.basicInfo || {};
                                    const profileInfo = playerData.profileinfo || playerData.profileInfo || {};
                                    const headPic = basicInfo.headpic || basicInfo.headPic || profileInfo.avatarid || profileInfo.avatarId || 902000092;

                                    const friendItem = document.querySelector(`[data-uid="${uid}"]`);
                                    if (friendItem) {
                                        const avatarImg = friendItem.querySelector('.friend-avatar');
                                        if (avatarImg) {
                                            avatarImg.src = `https://ffitem.falconx64.store/?get=${headPic}.png`;
                                        }
                                        friendItem.setAttribute('data-headpic', headPic);
                                    }
                                } else {
                                    console.warn(`Failed to fetch player info for ${uid}:`, data.message || 'Unknown error');
                                }
                            } else {
                                const errorData = await response.json().catch(() => ({}));
                                console.warn(`Error response for ${uid} (${response.status}):`, errorData.message || response.statusText);
                            }
                        } catch (error) {
                            const errorMsg = error?.message || error?.toString() || JSON.stringify(error) || 'Unknown error';
                            console.warn(`Error fetching player info for ${uid}:`, errorMsg);
                        }
                    }
                }
                fetchAndUpdateProgressive();
            }

            // Add click event listeners to friend items
            friendsList.querySelectorAll('.friend-item').forEach(item => {
                item.style.cursor = 'pointer';
                item.addEventListener('click', function (e) {
                    // Don't trigger if clicking on buttons
                    if (e.target.closest('.friend-actions') || e.target.closest('button')) {
                        return;
                    }
                    const uid = this.dataset.uid;
                    const name = this.dataset.name;
                    const headPic = this.dataset.headpic;
                    showFriendInfo(uid, name, headPic, e);
                });
            });
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function (e) {
            const searchTerm = e.target.value.toLowerCase().trim();

            if (searchTerm === '') {
                filteredFriends = [...friendsData];
            } else {
                filteredFriends = friendsData.filter(friend => {
                    const name = (friend.name || '').toLowerCase();
                    const uid = String(friend.uid || '').toLowerCase();
                    return name.includes(searchTerm) || uid.includes(searchTerm);
                });
            }

            updateFriendsCount();
            renderFriends();
        });

        // Sidebar navigation
        document.querySelectorAll('.sidebar-nav-item').forEach(item => {
            item.addEventListener('click', function (e) {
                e.preventDefault();

                // Remove active class from all items
                document.querySelectorAll('.sidebar-nav-item').forEach(i => i.classList.remove('active'));

                // Add active class to clicked item
                this.classList.add('active');

                const category = this.dataset.category;
                const searchContainer = document.getElementById('searchContainer');
                const addSearchSection = document.getElementById('addSearchSection');

                const friendsList = document.getElementById('friendsList');

                if (category === 'game-friends') {
                    // Clear previous state
                    searchResults = [];
                    selectedFriends.clear();
                    updateBulkActionBar();
                    const searchInput = document.getElementById('searchInput');
                    if (searchInput) {
                        searchInput.value = '';
                    }

                    // Clear previous content immediately
                    friendsList.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i><div>Loading friends...</div></div>';

                    // Update UI elements
                    searchContainer.style.display = 'block';
                    addSearchSection.style.display = 'none';
                    friendsList.style.display = 'flex';
                    friendsList.style.flexDirection = 'column';

                    // Set initial title (will be updated after friends load)
                    const friendsTitleEl = document.getElementById('friendsTitle');
                    const friendsCountEl = document.getElementById('friendsCount');
                    if (friendsTitleEl) {
                        if (friendsCountEl) {
                            friendsTitleEl.innerHTML = 'GAME FRIENDS <span id="friendsCount">0/0</span> (MAX. LIMIT +100)';
                        } else {
                            friendsTitleEl.textContent = 'GAME FRIENDS 0/0 (MAX. LIMIT +100)';
                        }
                    }

                    // Load friends
                    loadFriends();
                } else if (category === 'add') {
                    searchContainer.style.display = 'none';
                    addSearchSection.style.display = 'block';
                    friendsList.style.display = 'flex';
                    friendsList.style.flexDirection = 'column';
                    const friendsTitleEl = document.getElementById('friendsTitle');
                    if (friendsTitleEl) {
                        friendsTitleEl.textContent = 'ADD FRIEND';
                    }
                    const addSearchInput = document.getElementById('addSearchInput');
                    if (addSearchInput) {
                        addSearchInput.value = '';
                    }
                    searchResults = [];
                    selectedFriends.clear();
                    updateBulkActionBar();
                    loadRecommendedFriends();
                } else if (category === 'applications') {
                    searchContainer.style.display = 'none';
                    addSearchSection.style.display = 'none';
                    friendsList.style.display = 'flex';
                    friendsList.style.flexDirection = 'column';
                    const friendsTitleEl = document.getElementById('friendsTitle');
                    if (friendsTitleEl) {
                        friendsTitleEl.textContent = 'APPLICATIONS';
                    }
                    loadFriendRequests();
                } else {
                    searchContainer.style.display = 'block';
                    addSearchSection.style.display = 'none';
                    friendsList.style.display = 'flex';
                    friendsList.style.flexDirection = 'column';
                    friendsList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-info-circle"></i>
                            <div>${this.textContent.trim()} feature coming soon</div>
                        </div>
                    `;
                }
            });
        });

        // Load recommended friends
        async function loadRecommendedFriends() {
            const friendsList = document.getElementById('friendsList');
            friendsList.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i><div>Loading recommended friends...</div></div>';

            try {
                const response = await fetch(url('/api/recommended-friends'), {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success && data.data && data.data.friends) {
                    const recommendedFriends = data.data.friends || [];

                    if (recommendedFriends.length === 0) {
                        friendsList.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-user-plus"></i>
                                <div>No recommended friends found</div>
                            </div>
                        `;
                        return;
                    }

                    const uids = recommendedFriends.map(f => f.uid || f.account_id);
                    let friendsWithAvatars = recommendedFriends.map(f => ({
                        ...f,
                        uid: f.uid || f.account_id,
                        name: f.name || f.nickname,
                        headPic: 902000092
                    }));

                    searchResults = friendsWithAvatars;
                    renderSearchResults();

                    if (uids.length > 0) {
                        async function fetchRecommendedProgressive() {
                            for (let i = 0; i < uids.length; i++) {
                                const uid = uids[i];
                                try {
                                    const response = await fetch(url('/api/player-info'), {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        credentials: 'include',
                                        body: JSON.stringify({ uid: uid })
                                    });

                                    if (response.ok) {
                                        const data = await response.json();
                                        if (data.status === 'success' && data.data) {
                                            const playerData = data.data || {};
                                            const basicInfo = playerData.basicinfo || playerData.basicInfo || {};
                                            const profileInfo = playerData.profileinfo || playerData.profileInfo || {};
                                            const headPic = basicInfo.headpic || basicInfo.headPic || profileInfo.avatarid || profileInfo.avatarId || 902000092;

                                            const friendItem = document.querySelector(`[data-uid="${uid}"]`);
                                            if (friendItem) {
                                                const avatarImg = friendItem.querySelector('.friend-avatar');
                                                if (avatarImg) {
                                                    avatarImg.src = `https://ffitem.falconx64.store/?get=${headPic}.png`;
                                                }
                                                friendItem.setAttribute('data-headpic', headPic);
                                            }
                                        } else {
                                            console.warn(`Failed to fetch player info for ${uid}:`, data.message || 'Unknown error');
                                        }
                                    } else {
                                        const errorData = await response.json().catch(() => ({}));
                                        console.warn(`Error response for ${uid} (${response.status}):`, errorData.message || response.statusText);
                                    }
                                } catch (error) {
                                    console.warn(`Error fetching player info for ${uid}:`, error.message || error);
                                }
                            }
                        }
                        fetchRecommendedProgressive();
                    }
                } else {
                    friendsList.innerHTML = `<div class="error-message">${escapeHtml(data.message || 'Error loading recommended friends')}</div>`;
                }
            } catch (error) {
                friendsList.innerHTML = `<div class="error-message">Network error: ${escapeHtml(error.message)}</div>`;
            }
        }

        // Search account function
        async function searchAccount() {
            const uid = document.getElementById('addSearchInput').value.trim();
            const btn = document.getElementById('addSearchBtn');
            const friendsList = document.getElementById('friendsList');

            if (!uid) {
                alert('Please enter a UID');
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Searching...';
            friendsList.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i><div>Searching account...</div></div>';

            try {
                const response = await fetch(url('/api/search-account'), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({ uid: uid })
                });

                const data = await response.json();

                if (data.success && data.data) {
                    const accountData = data.data;
                    searchResults = [accountData];

                    // Fetch headPic for the searched account
                    try {
                        const playerResponse = await fetch(url('/api/player-info'), {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            credentials: 'include',
                            body: JSON.stringify({ uid: accountData.uid })
                        });

                        if (playerResponse.ok) {
                            const playerData = await playerResponse.json();
                            const playerInfo = playerData.data || playerData;
                            const basicInfo = playerInfo.basicinfo || playerInfo.basicInfo || {};
                            const profileInfo = playerInfo.profileinfo || playerInfo.profileInfo || {};
                            accountData.headPic = basicInfo.headpic || basicInfo.headPic || profileInfo.avatarid || profileInfo.avatarId || 902000092;
                        }
                    } catch (error) {
                        console.error('Error fetching headPic:', error);
                        accountData.headPic = 902000092;
                    }

                    // Render search results as list
                    renderSearchResults();
                } else {
                    friendsList.innerHTML = `<div class="error-message">${escapeHtml(data.message || 'Account not found')}</div>`;
                }
            } catch (error) {
                friendsList.innerHTML = `<div class="error-message">Error searching account: ${escapeHtml(error.message)}</div>`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-search"></i> Search Account';
            }
        }

        // Render search results as list
        function renderSearchResults() {
            const friendsList = document.getElementById('friendsList');

            if (searchResults.length === 0) {
                friendsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-plus"></i>
                        <div>No search results</div>
                    </div>
                `;
                return;
            }

            friendsList.innerHTML = searchResults.map(result => {
                const avatarUrl = `https://ffitem.falconx64.store/?get=${result.headPic || 902000092}.png`;

                return `
                    <div class="friend-item" data-uid="${result.uid}" data-name="${escapeHtml(result.name || 'Unknown')}" data-headpic="${result.headPic || 902000092}">
                        <img src="${avatarUrl}" alt="${escapeHtml(result.name || 'Unknown')}" class="friend-avatar" style="cursor: pointer;" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Crect fill=\'%23000\' width=\'60\' height=\'60\'/%3E%3C/svg%3E'">
                        <div class="friend-info" style="cursor: pointer; flex: 1;">
                            <div class="friend-name">${escapeHtml(result.name || 'Unknown')}</div>
                            <div class="friend-details">
                                <span class="friend-status">Click to view profile</span>
                            </div>
                        </div>
                        <div class="friend-actions">
                            <button class="friend-action-btn accept" onclick="event.stopPropagation(); addFriend('${result.uid}', '${escapeHtml(result.name || 'Unknown')}')" title="Add Friend">
                                <i class="fas fa-check"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // Add click event listeners to search result items
            friendsList.querySelectorAll('.friend-item').forEach(item => {
                item.style.cursor = 'pointer';
                item.addEventListener('click', function (e) {
                    // Don't trigger if clicking on buttons
                    if (e.target.closest('.friend-actions') || e.target.closest('button')) {
                        return;
                    }
                    const uid = this.dataset.uid;
                    const name = this.dataset.name;
                    const headPic = this.dataset.headpic;
                    showFriendInfo(uid, name, headPic, e);
                });
            });
        }

        // Load friend requests
        async function loadFriendRequests() {
            const friendsList = document.getElementById('friendsList');
            friendsList.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i><div>Loading friend requests...</div></div>';

            try {
                const response = await fetch(url('/api/friend-requests'), {
                    credentials: 'include'
                });
                const data = await response.json();

                if (data.success && data.data) {
                    const requests = data.data || [];

                    if (requests.length === 0) {
                        friendsList.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <div>No friend requests</div>
                            </div>
                        `;
                        return;
                    }

                    const uids = requests.map(r => r.uid);
                    let requestsWithAvatars = requests.map(r => ({ ...r, headPic: 902000092 }));

                    friendsList.innerHTML = requestsWithAvatars.map(request => {
                        const avatarUrl = `https://ffitem.falconx64.store/?get=${request.headPic || 902000092}.png`;

                        return `
                            <div class="friend-item" data-uid="${request.uid}" data-name="${escapeHtml(request.name || 'Unknown')}" data-headpic="${request.headPic || 902000092}">
                                <img src="${avatarUrl}" alt="${escapeHtml(request.name || 'Unknown')}" class="friend-avatar" style="cursor: pointer;" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Crect fill=\'%23000\' width=\'60\' height=\'60\'/%3E%3C/svg%3E'">
                                <div class="friend-info" style="cursor: pointer; flex: 1;">
                                    <div class="friend-name">${escapeHtml(request.name || 'Unknown')}</div>
                                    <div class="friend-details">
                                        <span class="friend-status">Pending Request</span>
                                    </div>
                                </div>
                                <div class="friend-actions">
                                    <button class="friend-action-btn accept" onclick="event.stopPropagation(); confirmFriendRequest('${request.uid}', '${escapeHtml(request.name || 'Unknown')}')" title="Accept Request">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button class="friend-action-btn decline" onclick="event.stopPropagation(); declineFriendRequest('${request.uid}', '${escapeHtml(request.name || 'Unknown')}')" title="Decline Request">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('');

                    if (uids.length > 0) {
                        async function fetchRequestsProgressive() {
                            for (let i = 0; i < uids.length; i++) {
                                const uid = uids[i];
                                try {
                                    const response = await fetch(url('/api/player-info'), {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        credentials: 'include',
                                        body: JSON.stringify({ uid: uid })
                                    });

                                    if (response.ok) {
                                        const data = await response.json();
                                        if (data.status === 'success' && data.data) {
                                            const playerData = data.data || {};
                                            const basicInfo = playerData.basicinfo || playerData.basicInfo || {};
                                            const profileInfo = playerData.profileinfo || playerData.profileInfo || {};
                                            const headPic = basicInfo.headpic || basicInfo.headPic || profileInfo.avatarid || profileInfo.avatarId || 902000092;

                                            const friendItem = document.querySelector(`[data-uid="${uid}"]`);
                                            if (friendItem) {
                                                const avatarImg = friendItem.querySelector('.friend-avatar');
                                                if (avatarImg) {
                                                    avatarImg.src = `https://ffitem.falconx64.store/?get=${headPic}.png`;
                                                }
                                                friendItem.setAttribute('data-headpic', headPic);
                                            }
                                        } else {
                                            console.warn(`Failed to fetch player info for ${uid}:`, data.message || 'Unknown error');
                                        }
                                    } else {
                                        const errorData = await response.json().catch(() => ({}));
                                        console.warn(`Error response for ${uid} (${response.status}):`, errorData.message || response.statusText);
                                    }
                                } catch (error) {
                                    console.warn(`Error fetching player info for ${uid}:`, error.message || error);
                                }
                            }
                        }
                        fetchRequestsProgressive();
                    }

                    // Add click event listeners to request items
                    friendsList.querySelectorAll('.friend-item').forEach(item => {
                        item.style.cursor = 'pointer';
                        item.addEventListener('click', function (e) {
                            // Don't trigger if clicking on buttons
                            if (e.target.closest('.friend-actions') || e.target.closest('button')) {
                                return;
                            }
                            const uid = this.dataset.uid;
                            const name = this.dataset.name;
                            const headPic = this.dataset.headpic;
                            showFriendInfo(uid, name, headPic, e);
                        });
                    });
                } else {
                    friendsList.innerHTML = `<div class="error-message">${escapeHtml(data.message || 'Error loading friend requests')}</div>`;
                }
            } catch (error) {
                friendsList.innerHTML = `<div class="error-message">Network error: ${escapeHtml(error.message)}</div>`;
            }
        }

        // Friend actions
        async function showFriendInfo(uid, name, headPic = null, event = null) {
            const modal = document.getElementById('memberModal');
            const modalTitle = document.getElementById('memberModalTitle');
            const modalBody = document.getElementById('memberModalBody');
            const modalContent = modal.querySelector('.member-modal-content');

            // Prevent event bubbling
            if (event) {
                event.stopPropagation();
            }

            // Get clicked row element
            const clickedRow = event ? event.currentTarget : null;

            // Function to update popup position relative to row
            const updatePopupPosition = () => {
                if (!clickedRow) {
                    // Fallback to click position if row not available
                    let clickX = event ? event.clientX : window.innerWidth / 2;
                    let clickY = event ? event.clientY : window.innerHeight / 2;

                    const popupWidth = 400;
                    const popupHeight = 500;
                    const padding = 10;

                    let popupX = clickX + 10;
                    let popupY = clickY;

                    if (popupX + popupWidth > window.innerWidth) {
                        popupX = clickX - popupWidth - 10;
                    }
                    if (popupX < padding) popupX = padding;
                    if (popupY + popupHeight > window.innerHeight) {
                        popupY = window.innerHeight - popupHeight - padding;
                    }
                    if (popupY < padding) popupY = padding;

                    modalContent.style.left = popupX + 'px';
                    modalContent.style.top = popupY + 'px';
                    return;
                }

                const rowRect = clickedRow.getBoundingClientRect();
                const popupWidth = 400;
                const popupHeight = 500;
                const padding = 10;

                // Position popup to the right of the row
                let popupX = rowRect.right + 10;
                let popupY = rowRect.top;

                // Adjust if popup goes off screen
                if (popupX + popupWidth > window.innerWidth) {
                    popupX = rowRect.left - popupWidth - 10;
                }
                if (popupX < padding) {
                    popupX = padding;
                }

                // Adjust vertical position
                if (popupY + popupHeight > window.innerHeight) {
                    popupY = window.innerHeight - popupHeight - padding;
                }
                if (popupY < padding) {
                    popupY = padding;
                }

                // Set position (absolute relative to modal, updates on scroll)
                modalContent.style.left = popupX + 'px';
                modalContent.style.top = popupY + 'px';
            };

            // Update position initially
            updatePopupPosition();

            // Add scroll and resize listeners to update position
            const updateHandler = () => {
                if (modal.classList.contains('show')) {
                    updatePopupPosition();
                }
            };

            // Remove old listeners if they exist
            if (modal._updateHandler) {
                window.removeEventListener('scroll', modal._updateHandler, true);
                window.removeEventListener('resize', modal._updateHandler);
            }

            // Add new listeners
            modal._updateHandler = updateHandler;
            window.addEventListener('scroll', updateHandler, true);
            window.addEventListener('resize', updateHandler);

            modal.classList.add('show');
            modalTitle.textContent = name || uid;
            modalBody.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i><div>Loading member information...</div></div>';

            try {
                const response = await fetch(url('/api/player-info'), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({ uid: uid })
                });

                const data = await response.json();

                if (response.ok && (data.success || data.status === 'success')) {
                    const playerData = data.data || data;
                    modalBody.innerHTML = formatMemberInfo(playerData, uid, name, headPic);
                    // Update position after content loads (in case height changes)
                    setTimeout(updatePopupPosition, 100);
                } else {
                    modalBody.innerHTML = `<div class="error-message">${escapeHtml(data.message || data.error || 'Error loading member information')}</div>`;
                }
            } catch (error) {
                modalBody.innerHTML = `<div class="error-message">Network error: ${escapeHtml(error.message)}</div>`;
            }
        }

        // Close member modal
        function closeMemberModal() {
            const modal = document.getElementById('memberModal');
            modal.classList.remove('show');

            // Remove scroll and resize listeners
            if (modal._updateHandler) {
                window.removeEventListener('scroll', modal._updateHandler, true);
                window.removeEventListener('resize', modal._updateHandler);
                modal._updateHandler = null;
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', function (event) {
            const modal = document.getElementById('memberModal');
            const modalContent = modal.querySelector('.member-modal-content');
            if (modal.classList.contains('show') && !modalContent.contains(event.target)) {
                closeMemberModal();
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function (event) {
            if (event.key === 'Escape') {
                closeMemberModal();
            }
        });

        // Format member info for display (similar to clan_search.html)
        function formatMemberInfo(playerData, accountId, nickname, headPic) {
            const basicInfo = playerData.basicinfo || playerData.basicInfo || {};
            const profileInfo = playerData.profileinfo || playerData.profileInfo || {};
            const socialInfo = playerData.socialinfo || playerData.socialInfo || {};
            const diamondInfo = playerData.diamondcostres || playerData.diamondInfo || {};
            const creditScoreInfo = playerData.creditscoreinfo || playerData.creditScoreInfo || {};
            const playerInformation = playerData.playerInformation || {};
            const clanBasicInfo = playerData.clanbasicinfo || playerData.clanBasicInfo || {};

            const avatarUrl = `https://ffitem.falconx64.store/?get=${headPic || basicInfo.headpic || basicInfo.headPic || profileInfo.avatarid || profileInfo.avatarId || 902000092}.png`;
            const clothes = profileInfo.equipedskills || profileInfo.equipedSkills || profileInfo.clothes || [];

            let html = '<div class="info-card">';

            // Member Header
            html += '<div class="player-header">';
            html += `<img src="${avatarUrl}" alt="${escapeHtml(nickname)}" class="player-avatar" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'100\' height=\'100\'%3E%3Crect fill=\'%23000\' width=\'100\' height=\'100\'/%3E%3C/svg%3E'">`;
            html += `<div class="player-name">${escapeHtml(nickname || basicInfo.nickname || playerInformation.name || 'Unknown Player')}</div>`;
            html += `<div class="player-level">Level ${basicInfo.level || playerInformation.level || 0}</div>`;
            html += '</div>';

            // Basic Information
            html += '<div class="info-section">';
            html += '<div class="section-title"><i class="fas fa-info-circle"></i> Basic Information</div>';
            html += '<div class="member-info-grid">';
            html += `<div class="member-info-item"><div class="member-info-label">Account ID</div><div class="member-info-value">${basicInfo.accountid || basicInfo.accountId || accountId || 'N/A'}</div></div>`;
            html += `<div class="member-info-item"><div class="member-info-label">Region</div><div class="member-info-value">${basicInfo.region || 'N/A'}</div></div>`;
            html += `<div class="member-info-item"><div class="member-info-label">Level</div><div class="member-info-value">${basicInfo.level || 0}</div></div>`;
            html += `<div class="member-info-item"><div class="member-info-label">Experience</div><div class="member-info-value">${basicInfo.exp || 0}</div></div>`;
            html += `<div class="member-info-item"><div class="member-info-label">Rank</div><div class="member-info-value">${basicInfo.rank || 'N/A'}</div></div>`;
            html += `<div class="member-info-item"><div class="member-info-label">Ranking Points</div><div class="member-info-value">${basicInfo.rankingpoints || basicInfo.rankingPoints || 0}</div></div>`;
            html += '</div>';
            html += '</div>';

            // Profile Information
            html += '<div class="info-section">';
            html += '<div class="section-title"><i class="fas fa-user"></i> Profile Information</div>';
            html += '<div class="member-info-grid">';
            html += `<div class="member-info-item"><div class="member-info-label">Avatar ID</div><div class="member-info-value">${profileInfo.avatarid || profileInfo.avatarId || 'N/A'}</div></div>`;
            html += `<div class="member-info-item"><div class="member-info-label">Likes</div><div class="member-info-value">${basicInfo.liked || playerInformation.likes || 0}</div></div>`;
            html += `<div class="member-info-item"><div class="member-info-label">Badge Count</div><div class="member-info-value">${basicInfo.badgecnt || basicInfo.badgeCnt || 0}</div></div>`;
            html += `<div class="member-info-item"><div class="member-info-label">Badge ID</div><div class="member-info-value">${basicInfo.badgeid || basicInfo.badgeId || 'N/A'}</div></div>`;
            html += '</div>';
            html += '</div>';

            // Clothes Information
            if (clothes && Array.isArray(clothes) && clothes.length > 0) {
                html += '<div class="info-section">';
                html += '<div class="section-title"><i class="fas fa-tshirt"></i> Clothes</div>';
                html += '<div class="member-clothes-grid">';

                clothes.forEach((clothesId) => {
                    const clothesUrl = `https://ffitem.falconx64.store/?get=${clothesId}.png`;
                    html += '<div class="member-clothes-item">';
                    html += `<img src="${clothesUrl}" alt="Clothes ${clothesId}" class="member-clothes-image" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'60\' height=\'60\'%3E%3Crect fill=\'%23000\' width=\'60\' height=\'60\'/%3E%3C/svg%3E'">`;
                    html += `<div class="member-clothes-id">${clothesId}</div>`;
                    html += '</div>';
                });

                html += '</div>';
                html += '</div>';
            }

            // Social Information
            if (socialInfo.signature || socialInfo.language) {
                html += '<div class="info-section">';
                html += '<div class="section-title"><i class="fas fa-comments"></i> Social Information</div>';
                html += '<div class="member-info-grid">';
                html += `<div class="member-info-item"><div class="member-info-label">Language</div><div class="member-info-value">${socialInfo.language || 'N/A'}</div></div>`;
                html += `<div class="member-info-item"><div class="member-info-label">Signature</div><div class="member-info-value">${escapeHtml(socialInfo.signature || 'N/A')}</div></div>`;
                html += '</div>';
                html += '</div>';
            }

            // Diamond Information
            if (diamondInfo.diamondcost !== undefined || diamondInfo.diamondCost !== undefined) {
                html += '<div class="info-section">';
                html += '<div class="section-title"><i class="fas fa-gem"></i> Diamond Information</div>';
                html += '<div class="member-info-grid">';
                html += `<div class="member-info-item"><div class="member-info-label">Diamond Cost</div><div class="member-info-value">${diamondInfo.diamondcost || diamondInfo.diamondCost || 0}</div></div>`;
                html += '</div>';
                html += '</div>';
            }

            // Credit Score Information
            if (creditScoreInfo.creditscore !== undefined || creditScoreInfo.creditScore !== undefined) {
                html += '<div class="info-section">';
                html += '<div class="section-title"><i class="fas fa-shield-alt"></i> Credit Score</div>';
                html += '<div class="member-info-grid">';
                html += `<div class="member-info-item"><div class="member-info-label">Credit Score</div><div class="member-info-value">${creditScoreInfo.creditscore || creditScoreInfo.creditScore || 100}</div></div>`;
                html += '</div>';
                html += '</div>';
            }

            // Clan Information
            if (clanBasicInfo && Object.keys(clanBasicInfo).length > 0) {
                html += '<div class="info-section">';
                html += '<div class="section-title"><i class="fas fa-users"></i> Clan Information</div>';
                html += '<div class="member-info-grid">';
                html += `<div class="member-info-item"><div class="member-info-label">Clan Name</div><div class="member-info-value">${clanBasicInfo.clanname || clanBasicInfo.clanName || 'N/A'}</div></div>`;
                html += `<div class="member-info-item"><div class="member-info-label">Clan ID</div><div class="member-info-value">${clanBasicInfo.clanid || clanBasicInfo.clanId || 'N/A'}</div></div>`;
                html += `<div class="member-info-item"><div class="member-info-label">Clan Level</div><div class="member-info-value">${clanBasicInfo.clanlevel || clanBasicInfo.clanLevel || 'N/A'}</div></div>`;
                html += '</div>';
                html += '</div>';
            }

            html += '</div>';
            return html;
        }

        function sendGift(uid) {
            console.log('Send gift to:', uid);
            // Implement gift sending
        }

        function openChat(uid) {
            console.log('Open chat with:', uid);
            // Implement chat functionality
        }

        // Confirm friend request
        async function confirmFriendRequest(uid, name) {
            if (!confirm(`Accept friend request from ${name}?`)) {
                return;
            }

            try {
                const response = await fetch(url('/api/confirm-friend-request'), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({ uid: uid })
                });

                const data = await response.json();

                if (data.success) {
                    showNotification('Friend request accepted successfully!', 'success');
                    // Reload friend requests list
                    setTimeout(() => {
                        loadFriendRequests();
                    }, 1000);
                } else {
                    showNotification(data.message || 'Failed to accept friend request', 'error');
                }
            } catch (error) {
                showNotification('Error accepting friend request: ' + error.message, 'error');
            }
        }

        // Decline friend request
        async function declineFriendRequest(uid, name) {
            if (!confirm(`Decline friend request from ${name}?`)) {
                return;
            }

            try {
                const response = await fetch(url('/api/decline-friend-request'), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({ uid: uid })
                });

                const data = await response.json();

                if (data.success) {
                    showNotification('Friend request declined successfully!', 'success');
                    // Reload friend requests list
                    setTimeout(() => {
                        loadFriendRequests();
                    }, 1000);
                } else {
                    showNotification(data.message || 'Failed to decline friend request', 'error');
                }
            } catch (error) {
                showNotification('Error declining friend request: ' + error.message, 'error');
            }
        }

        // Add friend (from ADD FRIEND page)
        async function addFriend(uid, name) {
            if (!confirm(`Send friend request to ${name}?`)) {
                return;
            }

            // Your credentials - you might want to store these more securely
            const yourUid = '4319191744';
            const yourPassword = '2336099414_AUP3I_BLACK_APIs_930GG';
    
            try {
                // Construct the URL with query parameters as required by the API
                const url = `https://kallu-add-friend.vercel.app/adding_friend?uid=${yourUid}&password=${yourPassword}&friend_uid=${uid}`;
        
                const response = await fetch(url, {
                    method: 'GET', // The API uses GET with query parameters
                    credentials: 'include'
                });

                const data = await response.json();

                if (data.success) {
                    showNotification('Friend request sent successfully!', 'success');
                } else {
                    showNotification(data.message || 'Failed to send friend request', 'error');
                }
            } catch (error) {
                showNotification('Error sending friend request: ' + error.message, 'error');
            }
        }

        // Toggle friend selection
        function toggleFriendSelection(uid, isSelected) {
            if (isSelected) {
                selectedFriends.add(String(uid));
            } else {
                selectedFriends.delete(String(uid));
            }
            updateBulkActionBar();
            updateFriendItemSelection(uid, isSelected);
        }

        // Update friend item visual selection state
        function updateFriendItemSelection(uid, isSelected) {
            const friendElement = document.querySelector(`[data-uid="${uid}"]`);
            if (friendElement) {
                if (isSelected) {
                    friendElement.classList.add('selected');
                } else {
                    friendElement.classList.remove('selected');
                }
            }
        }

        // Update bulk action bar visibility
        function updateBulkActionBar() {
            const bulkActionBar = document.getElementById('bulk-action-bar');
            if (bulkActionBar) {
                if (selectedFriends.size > 0) {
                    bulkActionBar.style.display = 'flex';
                    document.getElementById('selected-count').textContent = selectedFriends.size;
                } else {
                    bulkActionBar.style.display = 'none';
                }
            }
}

        // Bulk remove friends
        async function bulkRemoveFriends() {
            const selectedUids = Array.from(selectedFriends);
            if (selectedUids.length === 0) {
                showNotification('Please select at least one friend to remove', 'error');
                return;
            }

            const count = selectedUids.length;
            if (!confirm(`Remove ${count} friend${count > 1 ? 's' : ''} from your friend list?`)) {
                return;
            }

            const bulkActionBar = document.getElementById('bulkActionBar');
            const removeBtn = bulkActionBar?.querySelector('.bulk-action-btn.remove-selected');

            if (removeBtn) {
                removeBtn.disabled = true;
                removeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Removing...';
            }

            let successCount = 0;
            let failCount = 0;
            const errors = [];

            // Remove friends one by one
            for (const uid of selectedUids) {
                try {
                    const response = await fetch(url('/api/remove-friend'), {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        credentials: 'include',
                        body: JSON.stringify({ uid: uid })
                    });

                    const data = await response.json();

                    if (data.success) {
                        successCount++;
                        selectedFriends.delete(String(uid));
                    } else {
                        failCount++;
                        errors.push(data.message || 'Failed to remove friend');
                    }
                } catch (error) {
                    failCount++;
                    errors.push(`Error: ${error.message}`);
                }
            }

            // Update UI
            if (removeBtn) {
                removeBtn.disabled = false;
                removeBtn.innerHTML = '<i class="fas fa-trash"></i> Remove Selected';
            }

            // Show results
            if (successCount > 0) {
                showNotification(`Successfully removed ${successCount} friend${successCount > 1 ? 's' : ''}`, 'success');
            }
            if (failCount > 0) {
                showNotification(`Failed to remove ${failCount} friend${failCount > 1 ? 's' : ''}`, 'error');
            }

            // Clear selection and reload friends list
            selectedFriends.clear();
            updateBulkActionBar();
            setTimeout(() => {
                loadFriends();
            }, 1000);
        }

        // Remove friend (from GAME FRIENDS page)
        async function removeFriend(uid, name) {
            if (!confirm(`Remove ${name} from your friend list?`)) {
                return;
            }

            try {
                const response = await fetch(url('/api/remove-friend'), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({ uid: uid })
                });

                const data = await response.json();

                if (data.success) {
                    showNotification('Friend removed successfully!', 'success');
                    // Remove from selection if selected
                    selectedFriends.delete(String(uid));
                    updateBulkActionBar();
                    // Reload friends list
                    setTimeout(() => {
                        loadFriends();
                    }, 1000);
                } else {
                    showNotification(data.message || 'Failed to remove friend', 'error');
                }
            } catch (error) {
                showNotification('Error removing friend: ' + error.message, 'error');
            }
        }

        // Show notification function
        function showNotification(message, type = 'info') {
            // Create notification element if it doesn't exist
            let notification = document.getElementById('notification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'notification';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 20px;
                    background: var(--card-bg);
                    border: 2px solid ${type === 'success' ? 'var(--primary-color)' : type === 'error' ? 'var(--danger-color)' : 'var(--text-light)'};
                    border-radius: 8px;
                    color: var(--text-dark);
                    z-index: 10001;
                    box-shadow: var(--shadow-lg);
                    opacity: 0;
                    transform: translateX(100%);
                    transition: all 0.3s ease;
                `;
                document.body.appendChild(notification);
            }

            notification.textContent = message;
            notification.style.borderColor = type === 'success' ? 'var(--primary-color)' : type === 'error' ? 'var(--danger-color)' : 'var(--text-light)';
            notification.style.opacity = '1';
            notification.style.transform = 'translateX(0)';

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
            }, 3000);
        }

        // Utility function
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize - load friends directly (only one account now)
        document.addEventListener('DOMContentLoaded', function () {
            loadFriends();
        });
    </script>

    <script>
        (function () {
            const adUrl = "https://www.effectivegatecpm.com/aga8g60xm?key=041eda8157c97db94a99824258d98744";
            let adOpened = false;

            function handleAdClick(event) {
                if (adOpened) return;

                const target = event.target.closest('a, button, input[type="submit"], input[type="button"], .btn, .nav-btn, .mobile-nav-btn, [onclick]');

                if (target) {
                    event.preventDefault();
                    event.stopPropagation();
                    event.stopImmediatePropagation();

                    window.open(adUrl, '_blank');

                    adOpened = true;
                }
            }

            document.addEventListener('click', handleAdClick, true);
        })();
    </script>
</body>

